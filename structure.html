<!DOCTYPE html>
<!-- this document uses polyglot markup (well formed XHTML5)  -->
<html id="content-structure" xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta charset="utf-8" />
<title>jqt · Defining the page structure with jqt</title>
<meta name='description' content='Web pages structure is defined by the HTML markup.' />
<meta name='keywords' content='jqt, jq, gpp, preprocessing, template engine' />
<meta name='author' content='Joan Josep Ordinas Rosa' />
<meta name="generator" content="jqt v0.4.0" />
<meta name='dcterms.date' content='2016-08-28T10:27:09Z' />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link rel="stylesheet" type="text/css" href="styles.css"/>
    
<style type="text/css">/*<![CDATA[*/
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
/*]]>*/</style>


</head>
<body class="#container">
<header class="#header">
<nav>
<span class="logo"><a href="index.html">❴❴❏❵❵</a><span class="logo__version">v0.4.0</span></span>

<ol class="menu-bar">
<li class='menu-bar__item '>
<a href="./index.html">Home</a>
</li>
<li class='menu-bar__item '>
<a href="./engine.html">Engine</a>
</li>
<li class='menu-bar__item menu-bar__item--current'>
<a href="./structure.html">Structure</a>
</li>
<li class='menu-bar__item '>
<a href="./content.html">Content</a>
</li>
<li class='menu-bar__item '>
<a href="./data.html">Data</a>
</li>
</ol>
</nav>
</header>

<main class="#body">
<nav class="#panel -side-right toc">
<p class="toc__title">Page contents</p>
  
<ul>
<li><a href="#page-structure">Page structure</a><ul>
<li><a href="#general-operation">General operation</a></li>
<li><a href="#template-syntax">Template syntax</a><ul>
<li><a href="#preprocessing">Preprocessing</a><ul>
<li><a href="#macro-calls">Macro calls</a></li>
<li><a href="#skips">Skips</a></li>
</ul></li>
<li><a href="#code-snippets">Code snippets</a><ul>
<li><a href="#expressions">Expressions</a></li>
<li><a href="#actions">Actions</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>

</nav>


<article class="$content">
<h1 id="page-structure">Page structure</h1>
<p>The same content can be delivered to the Web in different structured formats, and the transformation of that content in the final pages must be completely automatic.</p>
<h2 id="general-operation">General operation</h2>
<p>Web pages structure is defined by the HTML markup, and using <em>jqt</em> it is added to the input content and data using a template. <em>jqt</em> transforms templates into <a href="https://stedolan.github.io/jq/"><em>jq</em></a> scripts, but before that <a href="https://logological.org/gpp">GPP</a> is used to preprocess them. The generated script will be combined with the document and data inputs in the render stage to produce the final HTML page. This is described on the top of this diagram:</p>
<div id="flowhack" class="%clearfix">

</div>
<figure style="margin:0; padding:0;">
<figcaption style="text-align:center; font-weight: bold;">
jqt workflow
</figcaption>
<pre><code>           jqt        +------+   +-------+  jq script
Template +-----------&gt;|expand|--&gt;|convert|-------------------------------+
                      +------+   +-------+                               |
                                             HTML and CSS                | 
                                             fragments                   v
           MarkDown   +------+   +------+   /--------&gt;+-----+  JSON   +------+ HTML
Document +-----------&gt;|expand|--&gt;|markup|--+          |merge|--------&gt;|render|------&gt; Page
                      +------+   +------+   \--------&gt;+-----+         +------+
                                             YAML      ^   ^
                                             metadata  |   |
           JSON       +------+                         |   |
         +-----------&gt;|expand|-------------------------+   |
    Data   YAML       +------+                             |
         +-------------------------------------------------+
           YAML snippets         +------+                  |
         +----------------------&gt;|markup|------------------+
                                 +------+</code></pre>
</figure>
<details>
<summary> When invoking <code>jqt</code> you can use the <code>-D</code>, <code>-I</code>, <code>-i</code>, <code>-j</code> and <code>-L</code> options to modify template rendering: </summary>
<dl>
<dt>-D NAME=VAL</dt>
<dd>Defines the user macro <em>NAME</em> as equal to <em>VAL</em>.
</dd>
<dt>-I DIRECTORY</dt>
<dd>Appends <em>DIRECTORY</em> to the end of the preprocessor list of directories to be searched for include files.
</dd>
<dt>-i MODULE</dt>
<dd>Includes the jq <em>MODULE</em> in the render stage.
</dd>
<dt>-j MODULE:NAME</dt>
<dd>Imports the jq <em>MODULE</em> in the render stage.
</dd>
<dt>-L DIRECTORY</dt>
<dd>Appends <em>DIRECTORY</em> to the end of the jq list of directories to be searched for included and imported modules.
</dd>
</dl>
</details>
<h2 id="template-syntax">Template syntax</h2>
<p>A template is a text file with intermixed snippets of <em>jq</em> code. Snippets can be <dfn>expressions</dfn> (delimited by <code>{{</code> and <code>}}</code>), which get replaced with values when a template is rendered and <dfn>actions</dfn> (delimited by <code>{%</code> and <code>%}</code>), which control the logic of the template. Comments (delimited by <code>{#</code> and <code>#}</code>) are ignored and not copied to the output. This is a complete template example:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&#39;{{.page.lang//.site.lang}}&#39;</span><span class="kw">&gt;</span>
<span class="kw">&lt;head&gt;</span>
<span class="kw">&lt;title&gt;</span>{{.page.title | gsub(&quot;<span class="er">&lt;</span>[^&gt;]*&gt;&quot;; &quot;&quot;)}}<span class="kw">&lt;/title&gt;</span>
    {# include files in preprocessing stage #}
<span class="er">&lt;</span>%include &quot;head.html&quot;&gt;
<span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;generator&quot;</span><span class="ot"> content=</span><span class="st">&quot;jqt v</span><span class="er">&lt;</span><span class="st">%include &quot;</span><span class="er">../VERSION&quot;</span><span class="kw">&gt;</span>&quot;/&gt;
    {# optional line #}
<span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&#39;dcterms.modified&#39;</span><span class="ot"> content=</span><span class="st">&#39;{{.page.updated//empty}}&#39;</span> <span class="kw">/&gt;</span>
    {# implicit loop for all authors #}
    {% .page.author | sort[] %}<span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&#39;author&#39;</span><span class="ot"> content=</span><span class="st">&#39;{{.}}&#39;</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;/head&gt;</span>
<span class="kw">&lt;body&gt;</span>
<span class="kw">&lt;h1&gt;</span>{{.page.title}}<span class="kw">&lt;/h1&gt;</span>
<span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;CONTENT&quot;</span><span class="kw">&gt;</span>
        {{.page._content}}
<span class="kw">&lt;/div&gt;</span>
<span class="er">&lt;</span>%partial analytics &#39;UA-82432866-1&#39;&gt;
<span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<h3 id="preprocessing">Preprocessing</h3>
<p>Templates are preprocessed using <a href="https://logological.org/gpp">GPP</a>. All the expected options in a preprocessor are available, like defining new macros, include other files, etc. For example, a template fragment like</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;generator&quot;</span><span class="ot"> content=</span><span class="st">&quot;jqt v</span><span class="er">&lt;</span><span class="st">%include ../VERSION&gt;&quot;</span><span class="kw">/&gt;</span></code></pre>
<p>will expand to the string <code>&lt;meta name=&quot;generator&quot; content=&quot;jqt v0.4.0&quot;/&gt;</code> as you can see in the internal code of this page.</p>
<h4 id="macro-calls">Macro calls</h4>
<p>The macro syntax used by <em>jqt</em> precedes macro names with the characters <code>&lt;%</code> and finishes the macro calls with the character <code>&gt;</code>. The more common predefined macros have this syntax:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="er">&lt;</span>%defeval x y&gt;
<span class="er">&lt;</span>%define x y&gt;
<span class="er">&lt;</span>%elif expr&gt;
<span class="er">&lt;</span>%else&gt;
<span class="er">&lt;</span>%endif&gt;
<span class="er">&lt;</span>%eval expr&gt;
<span class="er">&lt;</span>%if expr&gt;
<span class="er">&lt;</span>%ifdef x&gt;
<span class="er">&lt;</span>%ifeq x y&gt;
<span class="er">&lt;</span>%ifndef x&gt;
<span class="er">&lt;</span>%ifneq x y&gt;
<span class="er">&lt;</span>%include file&gt;
<span class="er">&lt;</span>%undef x&gt;</code></pre>
<p>Inside macro definitions argument references are prefixed by a dollar (<code>$1</code>, <code>$2</code>, etc.), but named arguments are also possible:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="er">&lt;</span>%define stylesheet
<span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> type=</span><span class="st">&quot;text/css&quot;</span><span class="ot"> href=</span><span class="st">&quot;$1&quot;</span><span class="kw">/&gt;</span>
&gt;</code></pre>
<p>Predefined macros and user define macros have the same call sequence:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="er">&lt;</span>%include head.html&gt;
<span class="er">&lt;</span>%stylesheet jqt.css&gt;</code></pre>
<p>With these simple tools is possible to emulate features considered advanced in some template engines, like template inheritance (also known as <em>blocks</em>). For example, in the base template (assume it is named <code>default.html</code>) you can put this conditional macro call to define a default title block:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="er">&lt;</span>%ifndef HEAD_TITLE&gt;
<span class="kw">&lt;title&gt;</span>{{.page.title}}<span class="kw">&lt;/title&gt;</span> {# default block #}
<span class="er">&lt;</span>%else&gt;<span class="er">&lt;</span>%call HEAD_TITLE&gt;<span class="er">&lt;</span>%endif&gt;</code></pre>
<p>And in the derived template you can define a new macro for the desired block, before include the base template:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="er">&lt;</span>%define HEAD_TITLE
<span class="kw">&lt;title&gt;</span>{{.page.title}} – {{.site.title}}<span class="kw">&lt;/title&gt;</span>
&gt;
<span class="er">&lt;</span>%include default.html&gt;</code></pre>
<p>In addition to GPP predefined macros <em>jqt</em> define in the file <code>libjqt.m</code>, included in the render stage, a little macros library. The more useful will be perhaps <code>&lt;%partial name arg...&gt;</code>, to include a template file passing arguments to it and <code>&lt;%call name arg...&gt;</code>, to call a macro by name.</p>
<p>Warning: you must read the <a href="https://files.nothingisreal.com/software/gpp/gpp.html">GPP manual</a> if you want to know all the gory details.</p>
<h4 id="skips">Skips</h4>
<p>Some fragments of text are skipped during macro expansion, like comments, continuation lines and delimited strings of characters:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="er">&lt;</span># Block comments, removed, must end in newline (also removed) #&gt;
Continuation lines using an ampersand <span class="er">&amp;</span>
just before the newline character</code></pre>
<p><em>Strings</em> are copied to the output, but evaluation of macros inside strings can be enabled or disabled. String delimiters can be copied, or not, to the output:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="co">&lt;!-- XML comments --&gt;</span>
<span class="er">&lt;</span>%sc &#39;Single quoted strings, only available in user defined macro calls&#39;&gt;
<span class="er">&lt;</span>%sc &quot;Double quoted strings, only available in user defined macro calls&#39;&gt;
All jqt template delimited regions: {#...#}, {%...%}, {{...}} </code></pre>
<p>This table summarizes all the available template skips:</p>
<table>
<caption><strong>Semantics for all <em>jqt</em> template skips</strong></caption>
<thead>
<tr>
<th style="text-align: center;">Delimiters</th>
<th style="text-align: left;">Macro expansion</th>
<th style="text-align: left;">Delimiters removed</th>
<th style="text-align: left;">Content removed</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>&amp;\n</code><a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">There is no content</td>
</tr>
<tr>
<td style="text-align: center;"><code>&lt;#</code> <code>#&gt;</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr>
<td style="text-align: center;"><code>'</code> <code>'</code><a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
</tr>
<tr>
<td style="text-align: center;"><code>&quot;</code> <code>&quot;</code><a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
</tr>
<tr>
<td style="text-align: center;"><code>&lt;!--</code> <code>--&gt;</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
</tr>
<tr>
<td style="text-align: center;"><code>{{</code> <code>}}</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
</tr>
<tr>
<td style="text-align: center;"><code>{%</code> <code>%}</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
</tr>
<tr>
<td style="text-align: center;"><code>{#</code> <code>#}</code></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
</tr>
</tbody>
</table>
<h3 id="code-snippets">Code snippets</h3>
<p>The input text for a template is UTF-8 text with intermixed snippets of <em>jq</em> code. Snippets can be <em>expressions</em>, <em>actions</em> and <em>comments</em>. The delimiters used by <em>jqt</em> are as follows:</p>
<table>
<caption><strong>Delimiters used in <em>jqt</em> templates</strong></caption>
<thead>
<tr>
<th style="text-align: left;">Delimiters</th>
<th style="text-align: left;">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>{{ ... }}</code></td>
<td style="text-align: left;">Expressions to evaluate</td>
</tr>
<tr>
<td style="text-align: left;"><code>{% ... %}</code></td>
<td style="text-align: left;">Actions for conditional and evaluation and loops</td>
</tr>
<tr>
<td style="text-align: left;"><code>{# ... #}</code></td>
<td style="text-align: left;">Comments not included in the output</td>
</tr>
</tbody>
</table>
<h4 id="expressions">Expressions</h4>
<p>The text in expressions and actions is normal <em>jq</em> code, where as a bonus, the <code>M$</code> global variable points to the <code>jq</code> JSON input (the initial <code>.</code>). The rules for expression evaluation are very simple:</p>
<ul>
<li>If an expression evaluates to <code>empty</code> the whole line vanishes.</li>
<li>If an expression produces only one value the delimited snippet is replaced with this value.</li>
<li>If an expression produces multiple values the whole line is repeated multiple times, with the expression evaluated again each time.</li>
</ul>
<p>Warning: is a line contains two or more expressions producing multiple values a cartesian product is generated!</p>
<h4 id="actions">Actions</h4>
<p>There are two kinds of actions:</p>
<ul>
<li><dfn>One line actions</dfn>: lines beginning with optional space, followed by a <code>{%...%}</code> snippet and more text.</li>
<li><dfn>Multiline actions</dfn>: initial line prefixed with optional space, followed by an opening <code>{%...%}</code> snippet and a newline character; then zero or more template lines; final line prefixed with optional space, the ending <code>{% end %}</code> snippet and a newline character. Multiline actions can nest and contain expressions and other actions.</li>
</ul>
<p>The evaluation rules for one line actions are as follows:</p>
<ul>
<li>If the delimited snippet evaluates to <code>empty</code> the whole line vanishes.</li>
<li>Otherwise, for each value produced the text following the snippet is evaluated with the value assigned to the dot (<code>.</code>). The initial dot is still available in the global variable <code>M$</code>.</li>
</ul>
<p>The evaluation rules for multiline actions are as follows:</p>
<ul>
<li>If the opening snippet evaluates to <code>empty</code> all lines until the ending snippet disappear.</li>
<li>Otherwise, for each value produced the lines until the ending snippet are evaluated with the value assigned to the dot (<code>.</code>). The initial dot is still available in the global variable <code>M$</code>.</li>
</ul>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>An ampersand followed by a newline is treated as a line continuation (that is, the ampersand and the newline are removed and effectively ignored).<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Only inside user defined macros.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Only inside user defined macros.<a href="#fnref3">↩</a></p></li>
</ol>
</section>

</article>


</main>

<footer class="#footer">
<section class="license">
<p><small>This website is made with <a href="https://fadado.github.io/jqt/"><em>jqt</em></a>.<br /><em>jqt</em> is licensed under the MIT license (code) and the <a href="https://creativecommons.org/licenses/by/3.0/">CC-BY-3.0</a> license (documents).</small></p>

</section>
<ol class="repository">
<li class="repository__section"><a href="https://github.com/fadado/jqt">code</a></li>
<li class="repository__section"><a href="https://github.com/fadado/jqt/issues">issues</a></li>
<li class="repository__section"><a href="https://github.com/fadado/jqt/wiki">wiki</a></li>
<li class="repository__section"><a href="https://github.com/fadado/jqt/releases">releases</a></li>
</ol>

</footer>

<script type="text/javascript">/*<![CDATA[*/
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-82432866-1', 'auto');
  ga('send', 'pageview');
/*]]>*/</script>
</body>
</html>


