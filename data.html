<!DOCTYPE html>
<!-- this document uses polyglot markup (well formed XHTML5)  -->
<html id="data" xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>

<meta charset="utf-8" />

<title>jqt · Managing the data model with jqt</title>
<meta name='description' content='jqt combines one template with one MarkDown document and a data model.' />
<meta name='keywords' content='jqt, JSON, YAML, gpp, preprocessing, data model' />
<meta name='author' content='Joan Josep Ordinas Rosa' />

<meta name="generator" content="JQT v0.5.1" />
<meta name='dcterms.date' content='2016-08-28T10:27:09Z' />

<link rel="shortcut icon" href="favicon.ico"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link rel="stylesheet" type="text/css" href="styles.css"/>
    
<style type="text/css">/*<![CDATA[*/
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
/*]]>*/</style>


</head>

<body class="#container">
<header class="#header">
<nav>
<span class="logo"><a title="jqt, the jq template engine" href="index.html">❴❴❏❵❵</a><span class="logo__version">v0.5.1</span></span>
<ol class="menu-bar">
<li class='menu-bar__item '>
<a href="index.html">Home</a>
</li>
<li class='menu-bar__item '>
<a href="engine.html">Engine</a>
</li>
<li class='menu-bar__item '>
<a href="structure.html">Structure</a>
</li>
<li class='menu-bar__item '>
<a href="content.html">Content</a>
</li>
<li class='menu-bar__item menu-bar__item_current'>
<a href="data.html">Data</a>
</li>
</ol>
</nav>
</header>
<main class="#body">
<nav class="#panel -side-right toc">
<p class="toc__title">Page contents</p>
  
<ul>
<li><a href="#data-model">Data model</a><ul>
<li><a href="#general-operation">General operation</a></li>
<li><a href="#data-formats">Data formats</a><ul>
<li><a href="#yaml-and-json">YAML and JSON</a></li>
<li><a href="#preprocessing">Preprocessing</a><ul>
<li><a href="#macro-calls">Macro calls</a></li>
<li><a href="#skips">Skips</a></li>
<li><a href="#css-preprocessor">CSS preprocessor</a></li>
</ul></li>
</ul></li>
<li><a href="#tools">Tools</a><ul>
<li><a href="#build-automation">Build automation</a></li>
<li><a href="#data-conversion">Data conversion</a></li>
<li><a href="#querying-data-files">Querying data files</a></li>
<li><a href="#process-front-matter">Process front matter</a></li>
</ul></li>
</ul></li>
</ul>

</nav>

<article class="$content">
<h1 id="data-model">Data model</h1>
<p>The simplest page always resides on a website, where there is a complex web of relationships between pages. As we have to imagine these relationships, we need a way to represent them: this is the data model.</p>
<h2 id="general-operation">General operation</h2>
<p><cite>jqt</cite> is designed to combine one template with one <a href="https://daringfireball.net/projects/markdown/">MarkDown</a> document and a <a href="https://en.wikipedia.org/wiki/Data_model">data model</a> to produce the final HTML result. To define the data model you can provide metadata in the document front matter to be inserted when rendering the template. Also, <code>jqt</code> accepts additional data files in the command line in <a href="http://yaml.org/">YAML</a> or <a href="http://json.org/">JSON</a> format to be merged with the document front matter. This is described on the bottom of this diagram:</p>
<figure style="margin:0; padding:0;clear:both;">
<figcaption style="text-align:center; font-weight: bold;">
jqt workflow
</figcaption>
<pre><code>           jqt        +------+   +-------+  jq script
Template +-----------&gt;|expand|--&gt;|convert|-------------------------------+
                      +------+   +-------+                               |
                                             HTML and CSS                | 
                                             fragments                   v
           MarkDown   +------+   +------+   /--------&gt;+-----+  JSON   +------+ HTML
Document +-----------&gt;|expand|--&gt;|markup|--+          |merge|--------&gt;|render|------&gt; Page
                      +------+   +------+   \--------&gt;+-----+         +------+
                                             YAML      ^   ^
                                             metadata  |   |
           JSON       +------+                         |   |
         +-----------&gt;|expand|-------------------------+   |
    Data   YAML       +------+                             |     CSS  +------+ 
         +-------------------------------------------------+    +----&gt;|expand|------&gt; Style
           YAML snippets         +------+                  |          +------+
         +----------------------&gt;|markup|------------------+
                                 +------+</code></pre>
</figure>
<details>
<summary> When invoking <code>jqt</code> you can use the <code>-D</code>, <code>-I</code>, <code>-M</code>, <code>-m</code>, <code>-n</code> and <code>-T</code> options to define the additional input data and influence JSON preprocessing: </summary>
<dl>
<dt>-D NAME=STRING</dt>
<dd>Defines the user macro <em>NAME</em> as equal to <em>STRING</em>.
</dd>
<dt>-I DIRECTORY</dt>
<dd>Appends <em>DIRECTORY</em> to the end of the preprocessor list of directories to be searched for include files.
</dd>
<dt>-M NAME:FILE</dt>
<dd>Adds a <em>FILE</em> in YAML or JSON format to the input data at the top level (<em>NAME</em> is ignored but must be present and unique).
</dd>
<dt>-m NAME:FILE</dt>
<dd>Adds a <em>FILE</em> in YAML or JSON format to the input data as the value of object <em>NAME</em>.
</dd>
<dt>-T [NAME:FILE]</dt>
<dd>Transforms front matter YAML top level MarkDown scalar values to HTML. If <em>NAME:FILE</em> is provided add the transformed data to the input data as a value of object <em>NAME</em>. Otherwise, outputs a new YAML document.
</dd>
</dl>
</details>
<h2 id="data-formats">Data formats</h2>
<p><cite>jqt</cite> accepts metadata in <a href="http://yaml.org/">YAML</a> and <a href="http://json.org/">JSON</a> formats.</p>
<h3 id="yaml-and-json">YAML and JSON</h3>
<p>Documents front matter metadata and additional input YAML files are converted to JSON and merged to be the <code>jq</code> input in the render stage. No preprocessing is applied to YAML data.</p>
<p>The front matter content is available in the global object <code>._front_matter</code>. Reserved global names are prefixed with the underline character (<code>_</code>), and the following are provided:</p>
<ul>
<li><code>._content</code>: the rendered input document.</li>
<li><code>._front_matter</code>: the document front-matter.</li>
<li><code>._highlight</code>: CSS styles for highlighted code.</li>
<li><code>._source</code>: the input document pathname as provided to <code>jqt</code>.</li>
<li><code>._toc</code>: the rendered input document table of contents.</li>
<li><code>._version</code>: <cite>jqt</cite> installed version.</li>
</ul>
<p>Additional JSON files can be provided and are merged with front matter metadata to be the <code>jq</code> input in the render stage.</p>
<h3 id="preprocessing">Preprocessing</h3>
<p>JSON files are preprocessed using <a href="https://logological.org/gpp">GPP</a>, and all the expected options in a preprocessor are available, like defining new macros, include other files, etc. CSS files are also preprocessed with the same macros syntax used in JSON files.</p>
<h4 id="macro-calls">Macro calls</h4>
<p>The macro syntax used by <cite>jqt</cite> in JSON and CSS files is very similar to the syntax used by the traditional TeX language macro processor, but changing the prefix character <code>\</code> by <code>&amp;</code>. Here are some of the predefined macros:</p>
<pre><code>&amp;defeval{x}{y}
&amp;define{x}{y}
&amp;elif{expr}
&amp;else
&amp;endif
&amp;eval{expr}
&amp;if{expr}
&amp;ifdef{x}
&amp;ifeq{x}{y}
&amp;ifndef{x}
&amp;ifneq{x}{y}
&amp;include{file}
&amp;undef{x}</code></pre>
<p>Inside macro definitions numeric parameters are prefixed by a dollar (<code>$1</code>, <code>$2</code>, etc.), but named parameters, prefixed with the <code>&amp;</code> character, are also possible. The more used features are the inclusion on external files and the definition of simple constants:</p>
<pre><code>// JSON example
&amp;define{eur}{\u20AC}
&amp;define{price}{$1 &amp;euro}

{ &quot;price&quot;: &quot;&amp;price{100}&quot; }</code></pre>
<pre><code>// CSS example
&amp;include{theme.css}
&amp;define{Blue}{#0000FF}

{ color: &amp;Blue; }</code></pre>
<p>Warning: you must see the <a href="https://files.nothingisreal.com/software/gpp/gpp.html">GPP manual</a> if you want to know all the gory details.</p>
<h4 id="skips">Skips</h4>
<p>One use of the preprocessor is to remove comments in the C and C++ languages style:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">/* Block comments */</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">// Line comments</span></span></code></pre></div>
<p>Double quoted strings are defined as skips, and backticks can be used to disable macro expansion (inside double quoted strings backticks are ignored). This table summarizes all the available skips:</p>
<table>
<caption><strong>Semantics for all JSON and CSS skips</strong></caption>
<thead>
<tr>
<th style="text-align: center;">Delimiters</th>
<th>Macro expansion</th>
<th>Delimiters removed</th>
<th>Content removed</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>&amp;\n</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></td>
<td>No</td>
<td>Yes</td>
<td>There is no content</td>
</tr>
<tr>
<td style="text-align: center;"><code>/*</code> <code>*/</code></td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td style="text-align: center;"><code>//</code> <code>\n</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td style="text-align: center;"><code>`</code> <code>`</code></td>
<td>No</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td style="text-align: center;"><code>"</code> <code>"</code></td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td style="text-align: center;"><code>'</code> <code>'</code><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>Observe that single quote strings are defined only for CSS files.</p>
<h4 id="css-preprocessor">CSS preprocessor</h4>
<p><cite>jqt</cite> offers an standalone CSS preprocessor. Macros can be defined, files included, etc.</p>
<details>
<summary> To enable CSS preprocessing the <code>-P</code> option must be used with the <code>css</code> or <code>css-min</code> options: </summary>
<dl>
<dt>-P LANGUAGE</dt>
<dd>Expands input file with the macro-processor (<em>LANGUAGE</em> can be <code>jqt</code>, <code>md</code>, <code>json</code>, <code>css</code> or <code>css-min</code>).
</dd>
</dl>
</details>
<p>You can minify the CSS style sheet choosing the <code>css-min</code> option. The CSS minimization is not extremely aggressive, but is safe and fast.</p>
<h2 id="tools">Tools</h2>
<h3 id="build-automation">Build automation</h3>
<p>One step over any templating system is a static site generator. A companion site generator to <cite>jqt</cite> is <cite>sake</cite>, a simple wrapper to <cite>GNU Make</cite> used to build this very same site.</p>
<h3 id="data-conversion">Data conversion</h3>
<p>When preparing data inputs sometimes you need to mix files in several formats. To make easy the integration of data from several sources <cite>jqt</cite> comes with the following utilities to convert between CSV, JSON and YAML formats:</p>
<ul>
<li><code>csv2json</code></li>
<li><code>csv2yaml</code></li>
<li><code>json2csv</code></li>
<li><code>json2yaml</code></li>
<li><code>yaml2csv</code></li>
<li><code>yaml2json</code></li>
</ul>
<p>These utilities are filters that read standard input or a file passed as an argument and write to standard output.</p>
<h3 id="querying-data-files">Querying data files</h3>
<p>Sometimes you want to apply queries in the <em>jq</em> style to CSV or YAML files, in the same style as <em>jq</em> processes JSON data. As wrappers to <code>jq</code> you have the following utilities shipped with <cite>jqt</cite>:</p>
<ul>
<li><code>cq</code>, apply <code>jq</code> to CSV input files.</li>
<li><code>yq</code>, apply <code>jq</code> to YAML input files.</li>
</ul>
<p>These utilities imitate the <code>jq</code> command line interface:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb6-1"><a href="#cb6-1"></a>$ yq <span class="st">&#39;.store.book[2]&#39;</span> tests/data/store.yaml</span>
<span id="cb6-2"><a href="#cb6-2"></a>---</span>
<span id="cb6-3"><a href="#cb6-3"></a>author: Herman Melville</span>
<span id="cb6-4"><a href="#cb6-4"></a>category: fiction</span>
<span id="cb6-5"><a href="#cb6-5"></a>isbn: 0-553-21311-3</span>
<span id="cb6-6"><a href="#cb6-6"></a>price: 8.99</span>
<span id="cb6-7"><a href="#cb6-7"></a>title: Moby Dick</span>
<span id="cb6-8"><a href="#cb6-8"></a>...</span></code></pre></div>
<p>You can also preserve <code>jq</code> JSON output:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb7-1"><a href="#cb7-1"></a>$ yq --json -c <span class="st">&#39;.store.book[2]&#39;</span> tests/data/store.yaml</span>
<span id="cb7-2"><a href="#cb7-2"></a>{<span class="st">&quot;category&quot;</span>:<span class="st">&quot;fiction&quot;</span>,<span class="st">&quot;price&quot;</span>:8.99,<span class="st">&quot;author&quot;</span>:<span class="st">&quot;Herman Melville&quot;</span>,...</span></code></pre></div>
<p>See the output of <code>yq --help</code> and <code>cq --help</code> for more information.</p>
<h3 id="process-front-matter">Process front matter</h3>
<details>
<summary> When invoking <code>jqt</code> you can use the <code>-e</code>, <code>-r</code> and <code>-t</code> options to extract, remove or test the presence of front matter data in the input document: </summary>
<dl>
<dt>-e</dt>
<dd>Extracts and outputs the MarkDown document YAML front matter.
</dd>
<dt>-r</dt>
<dd>Removes the MarkDown document YAML front matter and outputs the document body.
</dd>
<dt>-t</dt>
<dd>Tests presence of front matter in MarkDown (indicated in the output status).
</dd>
</dl>
</details>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>An ampersand followed by a newline is treated as a line continuation (that is, the ampersand and the newline are removed and effectively ignored).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>This represents a newline character.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Only for CSS files.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</article>

</main>

<footer class="#footer">
<section class="license">
<p><small>This website is made with <a href="https://fadado.github.io/jqt/"><em>jqt</em></a>.<br /> <em>jqt</em> is licensed under the <a href="https://github.com/fadado/jqt/blob/master/LICENSE">MIT</a> license (code) and the <a href="https://creativecommons.org/licenses/by/3.0/">CC-BY-3.0</a> license (documents).</small></p>

</section>
<ol class="repository">
<li class="repository__section"><a href="https://github.com/fadado/jqt">code</a></li>
<li class="repository__section"><a href="https://github.com/fadado/jqt/issues">issues</a></li>
<li class="repository__section"><a href="https://github.com/fadado/jqt/wiki">wiki</a></li>
<li class="repository__section"><a href="https://github.com/fadado/jqt/releases">releases</a></li>
<li class="repository__section"><a href="#">top</a></li>
</ol>
</footer>
<script type="text/javascript">/*<![CDATA[*/
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-82432866-1', 'auto');
  ga('send', 'pageview');
/*]]>*/</script>
</body>
</html>


